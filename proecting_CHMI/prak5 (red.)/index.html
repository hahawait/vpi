<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>jQuery UI</title>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <link
      rel="stylesheet"
      href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/sunny/jquery-ui.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <style type="text/css">
      #dialog input {
        width: 150px;
        margin: 5px;
        text-align: left;
      }
      #dialog label {
        display: inline-block;
        width: 120px;
      }
      table {
        border-collapse: collapse;
        border: thin solid black;
        margin: 10px;
      }
      #placeholder {
        text-align: center;
      }
      #show {
        margin: 10px;
      }

      td,
      th {
        padding: 5px;
        width: 200px;
      }
      .sm {
        margin-top: 10px;
        margin-bottom: 10px;
      }
    </style>
    <script type="text/javascript">
      $(function () {
        $("#dialog").dialog({
          buttons: [
            { text: "Граничные условия", click: openDialog2 },
            { text: "Вычислить", click: resolveIntegral },
            { text: "Отмена" },
          ],
          modal: true,
          autoOpen: false,
          width: 640,
        });
        $("#dialog2").dialog({
          buttons: [{ text: "Задать", click: setRange }, { text: "Отмена" }],
          modal: true,
          autoOpen: false,
          width: 740,
        });
        var handle = $("#custom-handle");

        $("#slider").slider({
          create: function () {
            handle.text($(this).slider("value"));
          },
          slide: function (event, ui) {
            handle.text(ui.value);
          },
        });

        $("#slider2").slider({
          values: [35, 65],
          range: true,
          create: setInputsFrom2Slider,
          slide: setInputsFrom2Slider,
          stop: setInputsFrom2Slider,
        });

        $("#show")
          .button()
          .click(function () {
            $("#dialog").dialog("open");
            return false;
          });
        function openDialog2() {
          $("#dialog2").dialog("open");
          return false;
        }

        function setInputsFrom2Slider() {
          $("#min").val($("#slider2").slider("values", 0));
          $("#max").val($("#slider2").slider("values", 1));
          $("#min2").val($("#slider2").slider("values", 0));
          $("#max2").val($("#slider2").slider("values", 1));
        }

        function integral(a, b, n) {
          var s, d, xb, xe, x;
          s = 0;
          d = (b - a) / n;
          xb = a;
          for (i = 0; i < n; i++) {
            xe = xb + d;
            x = (xb + xe) / 2;
            s = s + d * (1 + x);
            xb = xe;
            progressVal += 100 / n;
            $("#progressDiv").progressbar("value", parseInt(progressVal));
          }
          return s;
        }

        var progressVal;

        function resolveIntegral() {
          progressVal = 0;
          $("#progressDiv").progressbar("value", progressVal);
          var a = parseFloat($("#min2").val());
          var b = parseFloat($("#max2").val());
          var N = parseFloat($("#slider").slider("value"));
          var result = integral(a, b, N);

          $("#result").val(result);
        }

        function setRange() {
          $("#dialog2").dialog("close");
        }

        $("input").change(function (e) {
          switch (this.id) {
            case "min2":
            case "max2":
              var index = this.id == "max2" ? 1 : 0;
              $("#slider2").slider("values", index, $(this).val());
              break;
          }
        });
        // Добавить текстовый индикатор
        $("#progressDiv").after(
          $(
            '<p style="text-align:center">Ход вычисления: <span id="progVal"></span></p>'
          )
        );

        $("#progressDiv").progressbar({
          value: 0,
          // Используем событие change
          change: function (e) {
            if (parseInt($("#progressDiv").progressbar("value")) < 99) {
              $("#progVal").text($("#progressDiv").progressbar("value") + "%");
            } else {
              $("#progressDiv").progressbar("value", 100);
              $("#progVal").text("Выполнено");
            }
          },
        });
      });
    </script>
  </head>
  <body>
    <div id="dialog" title="Интеграл" class="ui-widget">
      <div class="sm">
        <label for="min">Мин.значение: </label
        ><input id="min" readonly="true" value="0" /><label for="max">
          Макс.значение:
        </label>
        <input id="max" readonly="true" />
      </div>
      <div>
        <a>Количество шагов:</a>
      </div>
      <div class="sm" id="slider">
        <div id="custom-handle" class="ui-slider-handle"></div>
      </div>
      <div>
        <div id="progressDiv"></div>
      </div>

      <div><label for="result">Результат: </label><input id="result" /></div>
      <div id="dialog2" title="Границы" class="ui-widget">
        <div id="slider2" class="sm"></div>
        <div class="sm">
          <label for="min2">Мин.значение: </label><input id="min2" /><label
            for="max2"
            >Макс.значение: </label
          ><input id="max2" />
        </div>
      </div>
    </div>
    <button id="show">Вычислить интеграл</button>
  </body>
</html>
